<h1 class="absolute w-px h-px p-0 top-[0px] -m-px overflow-hidden clip-[rect(0,0,0,0)] whitespace-nowrap border-0">Look how they shine</h1>

<div class="wrapper h-screen w-screen relative" >
  {%- for block in section.blocks -%}
    {%- if block.settings.video -%}
      <div class="video-slide absolute top-0 left-0 w-full h-screen opacity-0 transition-opacity duration-[1.5s] ease-in-out z-0 [&.active]:opacity-100 [&.active]:z-[1]{% if forloop.first %} active{% endif %}" data-index="{{ forloop.index0 }}" {{ block.shopify_attributes }}>
        <video 
          class="video-player absolute min-h-full w-auto h-auto object-cover object-[var(--object-position-mobile)] lg:object-[var(--object-position)]" 
          style="--object-position-mobile: {{ block.settings.mobile-position }}%; --object-position: {{ block.settings.position }}%;"
          {% if forloop.first %}autoplay{% endif %}
          muted 
          loop
          playsinline
          poster="{{ block.settings.thumbnail | image_url: width: 2000 }}"
        >
          {% assign video_url = block.settings.video.sources[1].url %}
          {% comment %}theme-check-disable RemoteAsset{% endcomment %}
          <source src="{{ video_url }}" type="video/mp4" fetchpriority="high">
          Your browser doesn't support HTML5 video.
        </video>
      </div>
    {%- endif -%}
  {%- endfor -%}
</div>

{% javascript %}
  document.addEventListener('DOMContentLoaded', () => {
    const carousels = document.querySelectorAll('.video-carousel');
    
    carousels.forEach(carousel => {
      const heading = carousel.querySelector('.heading');
      const slides = carousel.querySelectorAll('.video-slide');

      let currentIndex = 0;

      function showSlide(index) {
        slides.forEach((slide, i) => {
          slide.classList.toggle('active', i === index);

          const video = slide.querySelector('video');
          if (video) {
            if (i === index) {
              video.currentTime = 0;
              video.play().catch(e => console.log('Autoplay prevented:', e));
            } else {
              setTimeout(() => {
                video.pause();
              }, 750);
            }
          }

        });
        currentIndex = index;
      }
      
      function nextSlide() {
        const nextIndex = (currentIndex + 1) % slides.length;
        showSlide(nextIndex);
      }
            
      showSlide(0);
      let autoplayInterval = setInterval(nextSlide, 4250);

    });
  });
{% endjavascript %}

{% schema %}
  {
    "name": "Video Carousel",
    "class": "video-carousel w-full h-screen relative overflow-hidden",
    "tag": "section",
    "limit": 1,
    "settings": [
      {
        "type": "text",
        "id": "heading",
        "label": "Heading"
      },
      {
        "type": "range",
        "id": "slide_duration",
        "min": 2,
        "max": 10,
        "step": 1,
        "unit": "sec",
        "label": "Slide duration",
        "default": 5
      },
          {
        "type": "range",
        "id": "slide_transition",
        "min": 100,
        "max": 5000,
        "step": 100,
        "unit": "ms",
        "label": "Slide duration",
        "default": 300
      },
      {
        "type": "range",
        "id": "parallax_speed",
        "min": 0,
        "max": 2,
        "step": 0.1,
        "label": "Parallax Speed",
        "default": 0.8,
        "info": "0 = Static, 1 = Normal, 2 = Fast parallax"
      }
    ],
    "max_blocks": 8,
    "blocks": [
      {
        "name": "Slide",
        "type": "slide",
        "settings": [
          {
            "type": "video",
            "id": "video",
            "label": "Video",
            "info": "MP4 format recommended."
          },
          {
            "type": "image_picker",
            "id": "thumbnail",
            "label": "Fallback",
            "info": "Shown while video loads"
          },
          {
            "type": "text",
            "id": "description",
            "label": "Description ( for SEO )"
          },
          {
            "type": "header",
            "content": "Video positioning",
            "info": "Align the video for both mobile and desktop."
          },
          {
            "type": "range",
            "id": "mobile-position",
            "min": 0,
            "max": 100,
            "unit": "%",
            "step": 1,
            "label": "X Position",
            "default": 50,
            "info": "For Mobile Devices"

          },
          {
            "type": "range",
            "id": "position",
            "min": 0,
            "max": 100,
            "unit": "%",
            "step": 1,
            "label": "X Position",
            "default": 50,
            "info": "For Desktop"

          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Video Carousel",
        "category": "Media",
        "blocks": [
          {
            "type": "slide"
          },
          {
            "type": "slide"
          }
        ]
      }
    ],
    "enabled_on": {
      "templates": ["index"]
    }
  }
{% endschema %}