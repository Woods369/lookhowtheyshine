<!doctype html>
<html lang="{{ request.locale.iso_code }}">
  <head>
    {% # Critical rendering path - load in order %}
    <script t src="{{ 'tailwind-browser.min.js' | asset_url }}"></script>
    {% render 'css-variables' %}
    <link rel="stylesheet" href="{{ 'critical.css' | asset_url }}">
    <link rel="stylesheet" href="{{ 'splide.min.css' | asset_url }}">


    {% # Meta tags and favicon %}
    {% render 'meta-tags' %}
    {% if settings.favicon %}<link rel="icon" type="image/png" href="{{ settings.favicon | image_url: width: 32, height: 32 }}">{% endif %}

    {{ content_for_header }}

    {% # Early JavaScript for animations %}
    <script async src="{{ 'gsap.min.js' | asset_url }}"></script>
    <script async src="{{ 'morphsvg-plugin.min.js' | asset_url }}"></script>
    <script defer src="{{ 'main.js' | asset_url }}" type="module"></script>

    
    <style>
      body {
        padding-bottom: 200px;
      }

      body:has( > .main-content > header.open ) {
        max-height: 100svh;
        overflow: hidden;
      }
      
      .main-content {
        min-height: 100vh;
      }
    
    </style>
  </head>

  <body class="bg-white pb-[200px]{% if template.name == 'index' %} home {% endif %}">
    <div class="main-content z-20 relative">
      {% sections 'header-group' %}
      {{ content_for_layout }}
    </div>
    
    {% sections 'footer-group' %}
    
    {% render 'cart-drawer' %}
    <script defer src="{{ 'splide.min.js' | asset_url }}"></script>

    {% # Cart form interceptor - handles AJAX submissions %}
    <script>
      document.addEventListener("submit", function(e) {
        if (e.target.action && e.target.action.includes("cart/add")) {
          e.preventDefault();
          handleCartSubmission(e.target);
          return false;
        }
      }, true);

      async function handleCartSubmission(form) {
        const formData = new FormData(form);
        const button = form.querySelector('[type="submit"]');
        if (button) { button.textContent = "Adding..."; button.disabled = true; }
        try {
          const response = await fetch("/cart/add.json", { method: "POST", body: formData });
          if (response.ok) {
            setTimeout(() => {
              if (window.cartDrawer) { window.cartDrawer.open(); } else { alert("Item added to cart!"); }
            }, 200);
          } else {
            alert("Sorry, this item could not be added to your cart.");
          }
        } catch (error) {
          alert("Sorry, there was a problem adding this item to your cart. Please try again.");
        } finally {
          if (button) { button.textContent = "Add to cart"; button.disabled = false; }
        }
      }
    </script>

</body>
</html>
